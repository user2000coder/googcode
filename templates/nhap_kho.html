<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh·∫≠p kho s·∫£n ph·∫©m m·ªõi</title>    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nav.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        body {font-family: 'Roboto', Arial, sans-serif; background: #f4f8fd; margin: 0; }
        .container, .main-container {
            max-width: 1200px;
            margin: 40px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(25,118,210,0.08);
            padding: 32px 20px;
        }
        h1, h2, h3, h4, h5, h6, label, th {
            color: #1976d2;
        }
        button, .quick-btn, .export-btn {
            background: #1976d2 !important;
            color: #fff !important;
        }
        .stat-card {
            background: #1976d2 !important;
            color: #fff !important;
        }
        .quick-actions, .recent-activity, .alerts-section {
            background: #fff !important;
        }
        .success { color: #388e3c; }
        .error { color: #d32f2f; }
        .nk-container {
            max-width: 1100px;
            margin: 32px auto 0 auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(80, 60, 180, 0.10);
            padding: 32px 24px 24px 24px;
        }
        .nk-title {
            color: #5f3dc4;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 18px;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .nk-form {
            display: flex;
            flex-wrap: wrap;
            gap: 18px 32px;
            justify-content: center;
            margin-bottom: 18px;
            background: #f4f8fd;
            padding: 18px 12px 12px 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(25,118,210,0.06);
        }
        .nk-form-group {
            flex: 1 1 320px;
            min-width: 260px;
            max-width: 360px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .nk-form-group input, .nk-form-group textarea {
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #b6c6e3;
            font-size: 1rem;
            background: #fafdff;
        }
        .nk-form-group textarea { min-height: 38px; }
        .nk-btns {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            margin-top: 8px;
        }
        .nk-btn-main {
            background: linear-gradient(90deg, #7c3aed 0%, #5f3dc4 100%);
            color: #fff;
            padding: 12px 28px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            box-shadow: 0 2px 8px rgba(80, 60, 180, 0.10);
            cursor: pointer;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        .nk-btn-main:hover { background: linear-gradient(90deg, #5f3dc4 0%, #7c3aed 100%); }
        .nk-btn-reset {
            background: #f4f8fd;
            color: #5f3dc4;
            border: 1px solid #b6c6e3;
            padding: 12px 18px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
        }
        .nk-btn-reset:hover { background: #e3e6f7; }
        .nk-section {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(80, 60, 180, 0.08);
            padding: 24px 16px 18px 16px;
            margin-top: 32px;
        }
        .nk-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(25,118,210,0.06);
            font-size: 0.98rem;
            overflow: hidden;
        }
        .nk-table th, .nk-table td {
            border: none;
            padding: 10px 12px;
            text-align: center;
        }
        .nk-table th {
            background: #e3e6f7;
            color: #5f3dc4;
            font-weight: 700;
        }
        .nk-table tr:nth-child(even) { background: #f7f8fc; }
        .nk-table tr:hover { background: #f4f8fd; }
        .nk-table img { border: 1px solid #b6c6e3; border-radius: 6px; }
        .nk-table a { color: #5f3dc4; text-decoration: underline; }
        .nk-table .qr-link { display: inline-block; }
        .nk-table .qr-link img { width: 38px; height: 38px; object-fit: contain; }
        .nk-table .qr-link:hover img { box-shadow: 0 0 0 2px #7c3aed; }
        .nk-table thead { position: sticky; top: 0; z-index: 2; }
        .nk-table th, .nk-table td { white-space: nowrap; }
        .nk-table td { font-size: 0.97rem; }
        .nk-table th { font-size: 1.01rem; }
        .nk-table td:last-child, .nk-table th:last-child { text-align: center; }
        .nk-table td {
            border-bottom: 1px solid #e3e6f7;
        }
        .nk-table tr:last-child td { border-bottom: none; }
        .nk-table th:first-child, .nk-table td:first-child { border-top-left-radius: 12px; }
        .nk-table th:last-child, .nk-table td:last-child { border-top-right-radius: 12px; }
        .nk-table th, .nk-table td { vertical-align: middle; }
        .nk-table th { border-bottom: 2px solid #b6c6e3; }
        .nk-table td { border-right: 1px solid #f4f8fd; }
        .nk-table td:last-child { border-right: none; }
        .nk-table th:last-child { border-right: none; }
        .nk-table th:first-child { border-left: none; }
        .nk-table td:first-child { border-left: none; }
        .nk-table th, .nk-table td { min-width: 80px; }
        .nk-table th.qr, .nk-table td.qr { min-width: 60px; }
        .nk-table th.stt, .nk-table td.stt { min-width: 40px; }
        .nk-table th.location, .nk-table td.location { min-width: 100px; }
        .nk-table th.spec, .nk-table td.spec { min-width: 120px; }
        .nk-table th.name, .nk-table td.name { min-width: 120px; }
        .nk-table th.brand, .nk-table td.brand { min-width: 80px; }
        .nk-table th.unit, .nk-table td.unit { min-width: 60px; }
        .nk-table th.qty, .nk-table td.qty { min-width: 60px; }
        .nk-table th.date, .nk-table td.date { min-width: 120px; }
        .nk-table th input[type="text"] {
            width: 100%;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #b6c6e3;
            font-size: 0.97rem;
        }
        .nk-table .qr-link { display: flex; align-items: center; justify-content: center; }
        .nk-table .qr-link span { margin-left: 4px; font-size: 0.9rem; }
        .nk-table .qr-link img { margin: 0; }
        .nk-table .qr-link:hover img { border-color: #7c3aed; }
        .nk-table .qr-link:active img { border-color: #5f3dc4; }
        .nk-table .qr-link:focus img { outline: 2px solid #7c3aed; }
        .nk-table .qr-link:focus { outline: none; }
        .nk-table .qr-link:active { outline: none; }
        .nk-table .qr-link:visited { color: #5f3dc4; }
        .nk-table .qr-link:focus-visible { outline: 2px solid #7c3aed; }
        .nk-table .qr-link:focus:not(:focus-visible) { outline: none; }
        .nk-table .qr-link:active { outline: none; }
        .nk-table .qr-link:visited { color: #5f3dc4; }
        .nk-table .qr-link:focus-visible { outline: 2px solid #7c3aed; }
        .nk-table .qr-link:focus:not(:focus-visible) { outline: none; }
    </style>
</head>
<body>    <nav>
        <div>
            <div class="nav-logo">
                <img src="/static/SUMIDA-LOGO.jpg" alt="Sumida Logo" style="max-height:48px;width:auto;" />
                <a href="/" style="font-weight:700;font-size:1.18rem;">üìÅ Trang ch·ªß</a>
            </div>
            <div class="nav-menu">
                <a href="/nhap-kho">Nh·∫≠p kho</a>
                <a href="/xuat-kho">Xu·∫•t kho</a>
                <a href="/danh-sach">L·ªãch s·ª≠</a>
                <a href="/bao-cao">B√°o c√°o</a>
                <a href="/kiem-ke">Ki·ªÉm k√™ kho</a>
                <a href="/bo-sung-du-lieu">B·ªï sung d·ªØ li·ªáu</a>
            </div>
        </div>
    </nav>    <div class="nk-container">
        <div class="nk-title"><span>üì¶</span> Nh·∫≠p kho s·∫£n ph·∫©m m·ªõi</div>
        
        <div style="background: #e3f2fd; padding: 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #1976d2;">
            <h3 style="margin: 0 0 8px 0; color: #1976d2;">üìã H∆∞·ªõng d·∫´n:</h3>
            <p style="margin: 0; color: #1565c0;">
                ‚Ä¢ Nh·∫≠p <strong>Specification</strong> tr∆∞·ªõc ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin (n·∫øu v·∫≠t t∆∞ ƒë√£ t·ªìn t·∫°i)<br>
                ‚Ä¢ C√°c tr∆∞·ªùng c√≥ d·∫•u * l√† b·∫Øt bu·ªôc<br>
                ‚Ä¢ Nh·∫•n n√∫t "üîç Auto Fill" ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin t·ª´ specification
            </p>
        </div>

        <form id="data-form" class="nk-form">
            <!-- Th√¥ng tin c∆° b·∫£n -->
            <div class="nk-form-group">
                <label>Group use (Nh√≥m s·ª≠ d·ª•ng) *:</label>
                <input type="text" id="group_use" name="group_use" required placeholder="Nh·∫≠p nh√≥m s·ª≠ d·ª•ng">
            </div>
            <div class="nk-form-group">
                <label>Product code (M√£ h√†ng) *:</label>
                <input type="text" id="product_code" name="product_code" required placeholder="Nh·∫≠p m√£ h√†ng">
            </div>
            <div class="nk-form-group">
                <label>Classify (Ph√¢n lo·∫°i BU) *:</label>
                <input type="text" id="classify" name="classify" required placeholder="Nh·∫≠p ph√¢n lo·∫°i BU">
            </div>
            <div class="nk-form-group">
                <label>Part Code *:</label>
                <input type="text" id="part_code" name="part_code" required placeholder="Nh·∫≠p Part Code">
            </div>
            <div class="nk-form-group">
                <label>Material name (T√™n h√†ng h√≥a) *:</label>
                <input type="text" id="material_name" name="material_name" required placeholder="Nh·∫≠p t√™n h√†ng h√≥a">
            </div>
            <div class="nk-form-group">
                <label>Specification/Drawing (Th√¥ng s·ªë k·ªπ thu·∫≠t) * üîç:</label>
                <input type="text" id="specification" name="specification" required placeholder="Nh·∫≠p th√¥ng s·ªë k·ªπ thu·∫≠t v√† nh·∫•n Tab ƒë·ªÉ auto-fill" 
                       title="Nh·∫≠p specification v√† nh·∫•n Tab ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin n·∫øu v·∫≠t t∆∞ ƒë√£ t·ªìn t·∫°i">
                <button type="button" id="autofill-btn" style="margin-top: 8px; background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üîç Auto Fill</button>
                <small style="color: #666; font-size: 0.85em;">üí° G·ª£i √Ω: Th·ª≠ nh·∫≠p "Thread: M6x1.0, Tube OD: 8mm, Material: Brass"</small>
            </div>
            <div class="nk-form-group">
                <label>Brand (Nh√† SX) *:</label>
                <input type="text" id="brand" name="brand" required placeholder="Nh·∫≠p nh√† s·∫£n xu·∫•t">
            </div>
            <div class="nk-form-group">
                <label>Unit (ƒê∆°n v·ªã) *:</label>
                <input type="text" id="unit" name="unit" required placeholder="Nh·∫≠p ƒë∆°n v·ªã (pcs, kg, m...)">
            </div>
            <div class="nk-form-group">
                <label>Location (V·ªã tr√≠) *:</label>
                <input type="text" id="location" name="location" required placeholder="A1-B2-C3">
            </div>
            <div class="nk-form-group">
                <label>Ng∆∞·ªùi nh·∫≠p kho *:</label>
                <input type="text" id="imported_by" name="imported_by" required placeholder="Nh·∫≠p t√™n ng∆∞·ªùi nh·∫≠p kho">
            </div>            <!-- Th√¥ng tin t·ªìn kho -->
            <div class="nk-form-group">
                <label>Opening stock (T·ªìn ƒë·∫ßu k·ª≥):</label>
                <input type="number" id="opening_stock" name="opening_stock" placeholder="0" step="any" value="0">
            </div>
            <div class="nk-form-group">
                <label>Closing stock (T·ªìn cu·ªëi k·ª≥):</label>
                <input type="number" id="closing_stock" name="closing_stock" placeholder="0" step="any" value="0">
            </div>
            <div class="nk-form-group">
                <label>Safety Stock (T·ªìn kho an to√†n):</label>
                <input type="number" id="safety_stock" name="safety_stock" placeholder="0" step="any" value="0">
            </div>

            <!-- Th√¥ng tin mua h√†ng -->
            <div class="nk-form-group">
                <label>Purchase SE (SE mua h√†ng):</label>
                <input type="text" id="purchase_se" name="purchase_se" placeholder="Nh·∫≠p SE mua h√†ng">
            </div>
            <div class="nk-form-group">
                <label>Purchase Order (ƒê∆°n h√†ng mua):</label>
                <input type="text" id="purchase_order" name="purchase_order" placeholder="Nh·∫≠p s·ªë PO">
            </div>

            <!-- Th√¥ng tin chi ph√≠ -->
            <div class="nk-form-group">
                <label>Cost opening stock (Chi ph√≠ t·ªìn ƒë·∫ßu k·ª≥):</label>
                <input type="number" id="cost_opening_stock" name="cost_opening_stock" placeholder="0" step="any" value="0">
            </div>
            <div class="nk-form-group">
                <label>Cost Input (Chi ph√≠ nh·∫≠p):</label>
                <input type="number" id="cost_input" name="cost_input" placeholder="0" step="any" value="0">
            </div>
            <div class="nk-form-group">
                <label>Cost Output (Chi ph√≠ xu·∫•t):</label>
                <input type="number" id="cost_output" name="cost_output" placeholder="0" step="any" value="0">
            </div>
            <div class="nk-form-group">
                <label>Cost closing stock (Chi ph√≠ t·ªìn cu·ªëi k·ª≥):</label>
                <input type="number" id="cost_closing_stock" name="cost_closing_stock" placeholder="0" step="any" value="0">
            </div>
            <div class="nk-form-group">
                <label>Cost safety stock (Chi ph√≠ t·ªìn kho an to√†n):</label>
                <input type="number" id="cost_safety_stock" name="cost_safety_stock" placeholder="0" step="any" value="0">
            </div>

            <!-- Th√¥ng tin gi√° -->
            <div class="nk-form-group">
                <label>Price (Gi√°):</label>
                <input type="number" id="price" name="price" placeholder="0" step="any" value="0">
            </div>
            <div class="nk-form-group">
                <label>Currency (Ti·ªÅn t·ªá):</label>
                <select id="currency" name="currency">
                    <option value="VND" selected>VND</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="JPY">JPY</option>
                </select>
            </div>

            <div class="nk-form-group">
                <label>S·ªë l∆∞·ª£ng *:</label>
                <input type="number" id="quantity" name="quantity" min="1" required placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng">
            </div>
            <div class="nk-btns" style="flex-basis:100%;justify-content:flex-end;">
                <label style="display:flex;align-items:center;gap:6px;font-weight:400;font-size:0.98rem;margin-right:18px;">
                    <input type="checkbox" id="auto_refresh" checked style="margin-right:4px;"> T·ª± ƒë·ªông l√†m m·ªõi sau khi nh·∫≠p
                </label>
                <button type="reset" class="nk-btn-reset">L√†m m·ªõi</button>
                <button type="submit" class="nk-btn-main"><span>üìÑ</span> T·∫°o m√£ QR & L∆∞u</button>
            </div>
        </form>
        <div id="result" style="text-align:center;font-weight:600;"></div>
        <div id="qr-download" style="margin-top:16px;text-align:center;"></div>
        <div id="qr-show" style="margin-top:16px;text-align:center;"></div>
    </div>
    <div class="nk-section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;flex-wrap:wrap;gap:10px;">
            <div class="nk-title" style="font-size:1.25rem;margin:0;gap:8px;"><span>üìã</span> L·ªãch s·ª≠ nh·∫≠p kho</div>
            <button id="delete-history-btn" style="background:#d32f2f;color:#fff;padding:8px 18px;border:none;border-radius:6px;font-weight:600;cursor:pointer;">üóëÔ∏è X√≥a l·ªãch s·ª≠ nh·∫≠p kho</button>
        </div>
        <div style="overflow-x:auto;width:100%;">
        <table class="nk-table">
            <thead>
                <tr>
                    <th class="stt">STT</th>
                    <th>Group use</th>
                    <th>Product code</th>
                    <th>Classify</th>
                    <th>Part Code</th>
                    <th class="name">Material name</th>
                    <th class="spec">Specification</th>
                    <th class="brand">Brand</th>
                    <th class="unit">Unit</th>
                    <th class="location">Location</th>
                    <th>Ng∆∞·ªùi nh·∫≠p kho</th>
                    <th class="qty">S·ªë l∆∞·ª£ng</th>
                    <th class="date">Ng√†y nh·∫≠p</th>
                    <th class="qr">M√£ QR</th>
                </tr>
            </thead>
            <tbody>
                {% for h in history %}
                <tr>
                    <td class="stt">{{ loop.index }}</td>
                    <td>{{ h['group_name'] }}</td>
                    <td>{{ h['product_code'] }}</td>
                    <td>{{ h['classification'] }}</td>
                    <td>{{ h['part_code'] }}</td>
                    <td class="name">{{ h['material_name'] }}</td>
                    <td class="spec">{{ h['specification'] }}</td>
                    <td class="brand">{{ h['brand_name'] }}</td>
                    <td class="unit">{{ h['unit'] }}</td>
                    <td class="location">{{ h['location'] }}</td>
                    <td>{{ h['imported_by'] or h['imported_by'] }}</td>
                    <td class="qty">{{ h['quantity'] }}</td>
                    <td class="date">{{ h['created_at'] | format_datetime }}</td>
                    <td class="qr">
                        {% if h['specification'] %}
                        <a class="qr-link" href="/static/qr_codes/{{ h['specification'] }}.png" target="_blank">
                            <img src="/static/qr_codes/{{ h['specification'] }}.png" alt="QR">
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>    <script>
        // Auto-fill functionality
        document.getElementById('autofill-btn').addEventListener('click', function() {
            const specification = document.getElementById('specification').value.trim();
            if (!specification) {
                alert('Vui l√≤ng nh·∫≠p Specification tr∆∞·ªõc khi autofill!');
                return;
            }
            
            // Show loading
            const loadingMsg = document.createElement('div');
            loadingMsg.id = 'loading-msg';
            loadingMsg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#1976d2;color:white;padding:15px 25px;border-radius:10px;z-index:1000;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
            loadingMsg.innerHTML = 'üîç ƒêang t√¨m ki·∫øm th√¥ng tin v·∫≠t t∆∞...<br><small>Vui l√≤ng ƒë·ª£i...</small>';
            document.body.appendChild(loadingMsg);
            
            const searchUrl = `/api/search-material?specification=${encodeURIComponent(specification)}`;
            fetch(searchUrl)
                .then(response => response.json())
                .then(data => {
                    const loading = document.getElementById('loading-msg');
                    if (loading) loading.remove();
                    
                    if (data.status === 'success' && data.material) {
                        const material = data.material;                        if (confirm(`ƒê√£ t√¨m th·∫•y v·∫≠t t∆∞:\nüè∑Ô∏è T√™n: ${material.material_name || 'N/A'}\nüì¶ M√£ h√†ng: ${material.product_code || 'N/A'}\nüè¢ Nh√≥m: ${material.group_name || 'N/A'}\nüè≠ Nh√† SX: ${material.brand_name || 'N/A'}\n\nB·∫°n c√≥ mu·ªën t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin kh√¥ng?`)) {
                            // Auto-fill fields
                            let filledCount = 0;
                            
                            // Basic info
                            if (material.group_name) { document.getElementById('group_use').value = material.group_name; filledCount++; }
                            if (material.product_code) { document.getElementById('product_code').value = material.product_code; filledCount++; }
                            if (material.classification) { document.getElementById('classify').value = material.classification; filledCount++; }
                            if (material.part_code) { document.getElementById('part_code').value = material.part_code; filledCount++; }
                            if (material.material_name) { document.getElementById('material_name').value = material.material_name; filledCount++; }
                            if (material.brand_name) { document.getElementById('brand').value = material.brand_name; filledCount++; }
                            if (material.unit) { document.getElementById('unit').value = material.unit; filledCount++; }
                            if (material.location) { document.getElementById('location').value = material.location; filledCount++; }
                            if (material.imported_by) { document.getElementById('imported_by').value = material.imported_by; filledCount++; }
                            
                            // Stock info
                            if (material.opening_stock !== undefined) { document.getElementById('opening_stock').value = material.opening_stock; filledCount++; }
                            if (material.closing_stock !== undefined) { document.getElementById('closing_stock').value = material.closing_stock; filledCount++; }
                            if (material.safety_stock !== undefined) { document.getElementById('safety_stock').value = material.safety_stock; filledCount++; }
                            
                            // Purchase info
                            if (material.purchase_se) { document.getElementById('purchase_se').value = material.purchase_se; filledCount++; }
                            if (material.purchase_order) { document.getElementById('purchase_order').value = material.purchase_order; filledCount++; }
                            
                            // Cost info
                            if (material.cost_opening_stock !== undefined) { document.getElementById('cost_opening_stock').value = material.cost_opening_stock; filledCount++; }
                            if (material.cost_input !== undefined) { document.getElementById('cost_input').value = material.cost_input; filledCount++; }
                            if (material.cost_output !== undefined) { document.getElementById('cost_output').value = material.cost_output; filledCount++; }
                            if (material.cost_closing_stock !== undefined) { document.getElementById('cost_closing_stock').value = material.cost_closing_stock; filledCount++; }
                            if (material.cost_safety_stock !== undefined) { document.getElementById('cost_safety_stock').value = material.cost_safety_stock; filledCount++; }
                            
                            // Price info
                            if (material.price !== undefined) { document.getElementById('price').value = material.price; filledCount++; }
                            if (material.currency) { document.getElementById('currency').value = material.currency; filledCount++; }
                            
                            const successMsg = document.createElement('div');
                            successMsg.style.cssText = 'position:fixed;top:20px;right:20px;background:#4caf50;color:white;padding:15px 25px;border-radius:10px;z-index:1000;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
                            successMsg.innerHTML = `‚úÖ ƒê√£ t·ª± ƒë·ªông ƒëi·ªÅn ${filledCount} tr∆∞·ªùng th√¥ng tin!<br><small>Ki·ªÉm tra v√† ch·ªânh s·ª≠a n·∫øu c·∫ßn</small>`;
                            document.body.appendChild(successMsg);                            setTimeout(() => successMsg.remove(), 5000);
                        }
                    } else if (data.status === 'not_found') {
                        const infoMsg = document.createElement('div');
                        infoMsg.style.cssText = 'position:fixed;top:20px;right:20px;background:#ff9800;color:white;padding:15px 25px;border-radius:10px;z-index:1000;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
                        infoMsg.innerHTML = 'üÜï ƒê√¢y l√† v·∫≠t t∆∞ m·ªõi<br><small>Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin</small>';
                        document.body.appendChild(infoMsg);
                        setTimeout(() => infoMsg.remove(), 4000);
                    } else {
                        const errorMsg = document.createElement('div');
                        errorMsg.style.cssText = 'position:fixed;top:20px;right:20px;background:#f44336;color:white;padding:15px 25px;border-radius:10px;z-index:1000;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
                        errorMsg.innerHTML = '‚ùå C√≥ l·ªói x·∫£y ra<br><small>' + (data.message || 'Kh√¥ng th·ªÉ t√¨m ki·∫øm th√¥ng tin') + '</small>';
                        document.body.appendChild(errorMsg);
                        setTimeout(() => errorMsg.remove(), 4000);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    const loading = document.getElementById('loading-msg');
                    if (loading) loading.remove();
                    
                    const errorMsg = document.createElement('div');
                    errorMsg.style.cssText = 'position:fixed;top:20px;right:20px;background:#f44336;color:white;padding:15px 25px;border-radius:10px;z-index:1000;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
                    errorMsg.innerHTML = '‚ùå L·ªói k·∫øt n·ªëi<br><small>Kh√¥ng th·ªÉ t√¨m ki·∫øm th√¥ng tin v·∫≠t t∆∞</small>';
                    document.body.appendChild(errorMsg);
                    setTimeout(() => errorMsg.remove(), 4000);
                });
        });

        document.getElementById('data-form').onsubmit = async function(e) {
            e.preventDefault();
            const autoRefresh = document.getElementById('auto_refresh').checked;            // Get all form values
            const formData = {
                group_use: document.getElementById('group_use').value,
                product_code: document.getElementById('product_code').value,
                classify: document.getElementById('classify').value,
                part_code: document.getElementById('part_code').value,
                material_name: document.getElementById('material_name').value,
                specification: document.getElementById('specification').value,
                brand: document.getElementById('brand').value,
                unit: document.getElementById('unit').value,
                location: document.getElementById('location').value,
                imported_by: document.getElementById('imported_by').value,
                quantity: document.getElementById('quantity').value,
                opening_stock: document.getElementById('opening_stock').value || 0,
                closing_stock: document.getElementById('closing_stock').value || 0,
                safety_stock: document.getElementById('safety_stock').value || 0,
                purchase_se: document.getElementById('purchase_se').value,
                purchase_order: document.getElementById('purchase_order').value,
                cost_opening_stock: document.getElementById('cost_opening_stock').value || 0,
                cost_input: document.getElementById('cost_input').value || 0,
                cost_output: document.getElementById('cost_output').value || 0,
                cost_closing_stock: document.getElementById('cost_closing_stock').value || 0,
                cost_safety_stock: document.getElementById('cost_safety_stock').value || 0,
                price: document.getElementById('price').value || 0,
                currency: document.getElementById('currency').value
            };
            
            // Check required fields
            const requiredFields = ['group_use', 'product_code', 'classify', 'part_code', 'material_name', 'specification', 'brand', 'unit', 'location', 'quantity', 'imported_by'];
            for (let field of requiredFields) {
                if (!formData[field]) {
                    document.getElementById('result').innerText = 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!';
                    document.getElementById('result').style.color = '#d32f2f';
                    return false;
                }
            }
            
            document.getElementById('result').innerText = 'ƒêang x·ª≠ l√Ω...';
            document.getElementById('result').style.color = '#1976d2';
            
            console.log('Sending data:', formData);
            
            fetch('/nhap-kho', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(res => {
                console.log('Response status:', res.status);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                return res.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.status === 'success') {
                    document.getElementById('result').innerText = data.message;
                    document.getElementById('result').style.color = '#388e3c';
                    if (data.qr_code) {
                        document.getElementById('qr-download').innerHTML = 
                            `<a href="/static/qr_codes/${data.qr_code}.png" download style="background:#1976d2;color:#fff;padding:12px 24px;border-radius:8px;text-decoration:none;font-weight:600;">üì• T·∫£i m√£ QR</a>`;
                        document.getElementById('qr-show').innerHTML = 
                            `<img src="/static/qr_codes/${data.qr_code}.png" alt="QR Code" style="max-width:200px;border:1px solid #ddd;border-radius:8px;">`;
                    }
                    if (autoRefresh) {
                        setTimeout(() => window.location.reload(), 2000);
                    }                } else {
                    document.getElementById('result').innerText = data.message || 'C√≥ l·ªói x·∫£y ra!';
                    document.getElementById('result').style.color = '#d32f2f';
                }
            })
            .catch(err => {
                console.error('Error details:', err);
                document.getElementById('result').innerText = 'C√≥ l·ªói x·∫£y ra: ' + err.message;
                document.getElementById('result').style.color = '#d32f2f';
            });return false;
        }
        
        document.getElementById('delete-history-btn').onclick = function() {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ nh·∫≠p kho?')) return;
            fetch('/delete-nhap-kho-history', { method: 'POST' })
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'success') {
                        window.location.reload();
                    } else {
                        alert(data.message || 'C√≥ l·ªói khi x√≥a l·ªãch s·ª≠!');
                    }
                })
                .catch(() => alert('C√≥ l·ªói khi g·ª≠i y√™u c·∫ßu x√≥a l·ªãch s·ª≠!'));
        }
    </script>
    <footer class="footer">
        Ph√°t tri·ªÉn b·ªüi SEQPE
    </footer>
</body>
</html>
